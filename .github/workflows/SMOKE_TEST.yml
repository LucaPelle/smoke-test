name: Smoke test
on:
  schedule:
    - cron: '*/5 * * * *'  # Runs every 5 minutes
  workflow_dispatch:
    inputs:
      test_url:
        description: 'URL for smoke test'
        required: false
        default: 'https://casa.pellegriniluca.com'

jobs:
  smoke-test:
    runs-on: ubuntu-latest
    # Set defaults at job level; these can be overridden when the workflow is dispatched
    env:
      URL: ${{ github.event.inputs.test_url || 'https://casa.pellegriniluca.com' }}
      SLACK_WEBHOOK_URL: ''

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      # No browser required for requests-based smoke test

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Install dependencies (if present)
        run: |
          python -m pip install --upgrade pip
          if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

      # Playwright/browser install not required for requests-based check

      - name: Run smoke test and append output to step summary
        run: |
          echo "ðŸ“œ Console logs:" >> $GITHUB_STEP_SUMMARY
          python smoke_test.py >> $GITHUB_STEP_SUMMARY
